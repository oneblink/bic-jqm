(function(){define("api-php",["jquery","underscore"],function(e,t){var n={getAnswerSpaceMap:function(){return e.ajax("/_R_/common/3/xhr/GetConfig.php")},getInteractionResult:function(n,i,r){var a="";return i&&"object"==typeof i&&t.each(i,function(e,t){a+="&"+t+"="+e}),e.ajax("/_R_/common/3/xhr/GetAnswer.php?asn="+window.BMP.siteVars.answerSpace+"&iact="+n+"&ajax=false"+a,r)},getForm:function(t){return e.ajax("/_BICv3_/xhr/GetForm.php?asn="+window.BMP.siteVars.answerSpace+"&form="+t)},getDataSuitcase:function(t,n){return e.ajax("/_R_/common/3/xhr/GetMoJO.php?_id="+window.BMP.siteVars.answerSpaceId+"&_m="+t+"&_lc="+n,{dataType:"text"})},setPendingItem:function(t,n,i){return e.post("/_R_/common/3/xhr/SaveFormRecord.php?_asid="+window.BMP.siteVars.answerSpaceId+"&_fn="+t+"&_action="+n,i)}};return n}),define("data-pouch",["api-php","pouchdb","jquery","underscore"],function(e,t,n,i){var r=function(e){this.name=this.dbAdapter&&e?e:"BlinkMobile"};return i.extend(r.prototype,{dbAdapter:function(){var e=!1;return window.BMP.isBlinkGap===!0&&t.adapters.websql?e="websql://":t.adapters.idb&&(e="idb://"),e},create:function(e){var i,r;return i=new n.Deferred,r=new t(this.dbAdapter()+this.name,function(t,n){t?i.reject(t):n.post(e.toJSON(),function(e,t){e?i.reject(e):i.resolve(t)})}),i.promise()},update:function(e){var i,r,a;return i=new n.Deferred,a=this,r=new t(this.dbAdapter()+this.name,function(t,n){t?i.reject(t):n.put(e.toJSON(),function(t){t?i.reject(t):a.read(e).done(function(e){i.resolve(e)})})}),i.promise()},read:function(e){var i,r;return i=new n.Deferred,r=new t(this.dbAdapter()+this.name,function(t,n){t?i.reject(t):n.get(e.id,function(e,t){e?i.reject(e):i.resolve(t)})}),i.promise()},readAll:function(){var e,r;return e=new n.Deferred,r=new t(this.dbAdapter()+this.name,function(t,n){t?e.reject(t):n.allDocs({include_docs:!0},function(t,n){t?e.reject(t):e.resolve(i.map(n.rows,function(e){return e.doc}))})}),e.promise()},"delete":function(e){var i,r;return i=new n.Deferred,r=new t(this.dbAdapter()+this.name,function(t,n){t?i.reject(t):n.get(e.id,function(e,t){e?i.reject(e):n.remove(t,function(e,t){e?i.reject(e):i.resolve(t)})})}),i.promise()},deleteAll:function(){var e,i;return e=new n.Deferred,i=new t.destroy(this.name,function(t,n){t?e.reject(t):e.resolve(n)}),e.promise()},apiRequest:function(t){var r;return r=new n.Deferred,this.apiCall?r=e[this.apiCall].apply(this,i.map(this.apiParameters,function(e){return t.get(e)})):r.reject("No API call set"),r.promise()}}),r}),define("wrapper-backbone",["backbone","jquery","data-pouch"],function(e,t){return e.ajaxSync=e.sync,e.getSyncMethod=function(t){return t.data||t.collection&&t.collection.data?e.dataSync:e.ajaxSync},e.dataSync=function(e,n,i){var r,a,o;switch(r=n.data||n.collection.data,a=new t.Deferred,o=a.promise(),e){case"read":o=void 0!==n.id?r.read(n):r.readAll();break;case"create":o=r.create(n);break;case"update":o=r.update(n);break;case"patch":o=r.update(n);break;case"delete":o=r.delete(n)}return o.then(function(e){i.success&&i.success(e)},function(e){i.error&&i.error(e)}),n.trigger("request",n,o,i),o},e.sync=function(t,n,i){return e.getSyncMethod(n).apply(this,[t,n,i])},e}),define("model-interaction-mobile",["wrapper-backbone","jquery","underscore","api-php","jquerymobile"],function(e,t,n,i){var r=e.Model.extend({idAttribute:"_id",defaults:{header:null,content:null,contentTime:null,footer:null,name:null},inherit:function(e){if(this.has("parent")){var t,i=require("model-application-mobile");n.each(this.attributes,function(t,i){n.has(e,i)&&e[i]||(e[i]=t)},this),"app"!==this.get("parent")?(t=i.interactions.get(this.get("parent")),t.inherit(e)):n.each(i.attributes,function(t,i){n.has(e,i)&&e[i]||(e[i]=t)},i)}return e},performXSLT:function(){var e,i,r,a,o,s,c,d,l,u,p,f,m,h,g;if(this.has("args"))for(c=this.get("args"),d=e.match(/\$args\[[\w\:][\w\:\-\.]*\]/g),l=d?d.length:0,e=this.get("xsl"),u=0;l>u;u+=1)p="string"==typeof c[d[u].substring(1)]?c[d[u].substring(1)]:"",p=p.replace('"',""),p=p.replace("'",""),p=decodeURIComponent(p),e=e.replace(d[u],p);else e=this.get("xsl");m=e.match(/blink-stars\(([@\w.]+),\W*(\w+)\W*\)/),m&&require(["model-application-mobile"],function(t){for(;m;)h="",g=m[1],m=m[2],n.each(t.stars.where({type:m}),function(e){h+=" or "+g+"='"+e.get("_id")+"'"}),h=h.substr(4),e=h.length>0?e.replace(/\(?blink-stars\(([@\w.]+),\W*(\w+)\W*\)\)?/,"("+h+")"):e.replace(/\(?blink-stars\(([@\w.]+),\W*(\w+)\W*\)\)?/,"(false())"),m=e.match(/blink-stars\(([@\w.]+),\W*(\w+)\W*\)/)}),f=this,require(["model-application-mobile"],function(n){return i=f.get("starXml")?f.get("starXml"):n.datasuitcases.get(f.get("xml")).get("data"),r=e,"string"!=typeof i||"string"!=typeof r?(f.set("content","XSLT failed due to poorly formed XML or XSL."),void 0):(o=t.parseXML(i),e=t.parseXML(r),window.XSLTProcessor?(s=new window.XSLTProcessor,s.importStylesheet(e),a=s.transformToFragment(o,document)):a=void 0!==o.transformNode?o.transformNode(e):window.xsltProcess?window.xsltProcess(o,e):"<p>Your browser does not support Data Suitcase keywords.</p>",a&&f.set("content",a),void 0)})},prepareView:function(e){var r,a,o,s=new t.Deferred,c=this,d="";return c.id===window.BMP.siteVars.answerSpace&&require(["model-application-mobile"],function(e){e.has("homeScreen")&&e.get("homeScreen")!==!1&&e.has("homeInteraction")?(r=e.interactions.findWhere({dbid:"i"+e.get("homeInteraction")}),r&&r.set({parent:c.get("parent")}),a=e.interactions.findWhere({dbid:"a"+window.BMP.siteVars.answerSpace}),a&&a.set({parent:c.id}),r.prepareView().done(function(){s.resolve(r)})):s.resolve(c)}),"madl code"===c.get("type")&&i.getInteractionResult(c.id,this.get("args"),e.options).then(function(e){c.save({content:e,contentTime:Date.now()},{success:function(){s.resolve(c)},error:function(e){s.reject(e)}})},function(e,t,n){s.reject(n)}),"xslt"===c.get("type")&&0===c.get("xml").indexOf("stars:")&&c.set({mojoType:"stars",xml:c.get("xml").replace(/^stars:/,"")}),"xslt"===c.get("type")&&"stars"===c.get("mojoType")&&require(["model-application-mobile"],function(e){n.each(e.stars.where({type:c.get("xml")}),function(e){d+="<"+e.get("type")+' id="'+e.get("_id")+'">',o=n.clone(e.attributes),delete o._id,delete o._rev,delete o.type,delete o.state,n.each(o,function(e,t){d+="<"+t+">"+e+"</"+t+">"}),d+="</"+e.get("type")+">"}),d="<stars>"+d+"</stars>",c.set({starXml:d}),s.resolve(c)}),"madl code"!==c.get("type")&&c.id!==window.BMP.siteVars.answerSpace&&s.resolve(c),s.promise()},parseArgs:function(e){var t,i=e.split("&"),r={};return n.each(i,function(e){t=e.split("="),"args"!==t[0].substr(0,4)&&(t[0]="args["+t[0]+"]"),r[t[0]]=t[1]}),r?this.set({args:r}):this.set({args:null}),this}});return r}),define("collection-interactions-mobile",["wrapper-backbone","model-interaction-mobile","data-pouch","underscore"],function(e,t,n,i){var r=e.Collection.extend({model:t,initialize:function(){var e=this;e.data=new n(window.BMP.siteVars.answerSpace+"-Interaction"),e.fetch({success:function(){e.trigger("initialize")},error:function(){e.trigger("initialize")}})},save:function(){i.each(this.models,function(e){e.save()})}});return r}),define("model-datasuitcase-mobile",["wrapper-backbone","api-php"],function(e,t){var n=e.Model.extend({idAttribute:"_id",populate:function(){var e=this,n=0;this.has("contentTime")&&(n=this.get("contentTime")),t.getDataSuitcase(this.id,n).then(function(t){e.save({data:t,contentTime:Date.now()})},function(e,t,n){console.log(n)})}});return n}),define("collection-datasuitcases-mobile",["wrapper-backbone","model-datasuitcase-mobile","data-pouch"],function(e,t,n){var i=e.Collection.extend({model:t,initialize:function(){var e=this;e.data=new n(window.BMP.siteVars.answerSpace+"-DataSuitcase"),e.fetch({success:function(){e.trigger("initialize")},error:function(){e.trigger("initialize")}})}});return i}),define("model-form-mobile",["wrapper-backbone","BlinkForms","underscore","jquery","model-application-mobile","api-php"],function(e,t,n,i,r,a){var o=e.Model.extend({idAttribute:"_id",populate:function(){var e=this;a.getForm(this.id).then(function(t){e.save({definition:t.definition,contentTime:Date.now()})},function(e,t,n){console.log(n)})}});return o}),define("collection-forms-mobile",["wrapper-backbone","model-form-mobile","BlinkForms","jquery","underscore","data-pouch"],function(e,t,n,i,r,a){var o=e.Collection.extend({model:t,initialize:function(){var e=this;e.data=new a(window.BMP.siteVars.answerSpace+"-Form"),e.fetch({success:function(){e.trigger("initialize")},error:function(){e.trigger("initialize")}}),n.getDefinition=function(e,t){var n=new i.Deferred;return require(["model-application-mobile"],function(i){var a,o,s=i.forms.get(e).get("definition"),c=function(e){var n=e.default||{};return t&&e[t]&&r.extend(n,e[t]),n};s=JSON.parse(JSON.stringify(s)),r.isArray(s.default._elements)&&(s.default._elements=r.map(s.default._elements,c)),r.isArray(s.default._sections)&&(s.default._sections=r.map(s.default._sections,c)),r.isArray(s.default._pages)&&(s.default._pages=r.map(s.default._pages,c)),t||n.resolve(s.default),s[t]&&s[t]._elements&&(a=s.default._elements,delete s.default._elements,o=s[t]._elements,delete s[t]._elements,r.extend(s.default,s[t]),a=r.filter(a,function(e){return-1!==o.indexOf(e.name)}),a=r.sortBy(a,function(e){return o.indexOf(e.name)}),s.default._elements=a),n.resolve(s.default)}),n.promise()}}});return o}),define("model-pending-mobile",["wrapper-backbone"],function(e){var t=e.Model.extend({idAttribute:"_id"});return t}),define("collection-pending",["wrapper-backbone","model-pending-mobile","data-pouch","underscore","api-php"],function(e,t,n,i,r){var a=e.Collection.extend({model:t,initialize:function(){var e=this;e.data=new n(window.BMP.siteVars.answerSpace+"-Pending"),e.fetch({success:function(){e.trigger("initialize")},error:function(){e.trigger("initialize")}})},processQueue:function(){i.each(this.where({status:"Pending"}),function(e){r.setPendingItem(e.get("name"),e.get("action"),e.get("data")).done(function(){e.destroy({wait:!0})})},this)}});return a}),define("model-star-mobile",["wrapper-backbone"],function(e){var t=e.Model.extend({idAttribute:"_id",initialize:function(){this.on("add",function(){this.save()},this)},toggle:function(){var e=this;e.get("state")?this.set("state",!1):this.set("state",!0),require(["model-application-mobile"],function(t){e.get("state")?t.stars.add(e):e.destroy()})}});return t}),define("collection-stars-mobile",["wrapper-backbone","model-star-mobile","jquery","underscore","data-pouch"],function(e,t,n,i,r){var a=e.Collection.extend({model:t,initialize:function(){var e=this;e.data=new r(window.BMP.siteVars.answerSpace+"-Star"),e.fetch({success:function(){e.trigger("initialize")},error:function(){e.trigger("initialize")}})},clear:function(e){i.each(this.where({type:e}),function(e){e.destroy()})}});return a}),define("model-application-mobile",["wrapper-backbone","collection-interactions-mobile","collection-datasuitcases-mobile","model-datasuitcase-mobile","collection-forms-mobile","model-form-mobile","underscore","collection-pending","data-pouch","api-php","jquery","collection-stars-mobile"],function(e,t,n,i,r,a,o,s,c,d,l,u){var p,f=e.Model.extend({initialize:function(){var e=this,i=[],a=new l.Deferred,o=new l.Deferred,d=new l.Deferred,p=new l.Deferred,f=new l.Deferred;i.push(a.promise(),o.promise(),d.promise(),p.promise(),f.promise()),this.on("change",this.update),this.data=new c(window.BMP.siteVars.answerSpace+"-AnswerSpace"),this.interactions=(new t).once("initialize",function(){a.resolve()}),this.datasuitcases=(new n).once("initialize",function(){o.resolve()}),this.forms=(new r).once("initialize",function(){d.resolve()}),this.pending=(new s).once("initialize",function(){p.resolve()}),this.stars=(new u).once("initialize",function(){f.resolve()}),l.when.apply(l,i).then(function(){e.trigger("initialize")})},idAttribute:"_id",populate:function(){var e=this,t=new l.Deferred,n=t.promise();return d.getAnswerSpaceMap().then(function(n){var i=[];o.each(n,function(t,n){var r;("c"===n.substr(0,1)||"i"===n.substr(0,1))&&(r=t.pertinent,r._id=r.name,r.dbid=n,i.push(r)),"a"===n.substr(0,1)&&(r={_id:window.BMP.siteVars.answerSpace,dbid:n},i.push(r),e.save(t.pertinent))},e),e.interactions.set(i).save(),o.each(o.compact(o.uniq(e.interactions.pluck("xml"))),function(t){e.datasuitcases.get(t)||e.datasuitcases.create({_id:t},{success:function(e){e.populate()}})}),o.each(o.compact(o.uniq(e.interactions.pluck("blinkFormObjectName"))),function(t){e.forms.get(t)||e.forms.create({_id:t},{success:function(e){e.populate()}})}),e.trigger("initialize"),t.resolve()},function(){t.reject()}),n}});return p=new f}),define("text",["module"],function(e){var t,n,i=["Msxml2.XMLHTTP","Microsoft.XMLHTTP","Msxml2.XMLHTTP.4.0"],r=/^\s*<\?xml(\s)+version=[\'\"](\d)*.(\d)*[\'\"](\s)*\?>/im,a=/<body[^>]*>\s*([\s\S]+)\s*<\/body>/im,o="undefined"!=typeof location&&location.href,s=o&&location.protocol&&location.protocol.replace(/\:/,""),c=o&&location.hostname,d=o&&(location.port||void 0),l=[],u=e.config&&e.config()||{};return t={version:"2.0.3",strip:function(e){if(e){e=e.replace(r,"");var t=e.match(a);t&&(e=t[1])}else e="";return e},jsEscape:function(e){return e.replace(/(['\\])/g,"\\$1").replace(/[\f]/g,"\\f").replace(/[\b]/g,"\\b").replace(/[\n]/g,"\\n").replace(/[\t]/g,"\\t").replace(/[\r]/g,"\\r").replace(/[\u2028]/g,"\\u2028").replace(/[\u2029]/g,"\\u2029")},createXhr:u.createXhr||function(){var e,t,n;if("undefined"!=typeof XMLHttpRequest)return new XMLHttpRequest;if("undefined"!=typeof ActiveXObject)for(t=0;3>t;t+=1){n=i[t];try{e=new ActiveXObject(n)}catch(r){}if(e){i=[n];break}}return e},parseName:function(e){var t=!1,n=e.indexOf("."),i=e.substring(0,n),r=e.substring(n+1,e.length);return n=r.indexOf("!"),-1!==n&&(t=r.substring(n+1,r.length),t="strip"===t,r=r.substring(0,n)),{moduleName:i,ext:r,strip:t}},xdRegExp:/^((\w+)\:)?\/\/([^\/\\]+)/,useXhr:function(e,n,i,r){var a,o,s,c=t.xdRegExp.exec(e);return c?(a=c[2],o=c[3],o=o.split(":"),s=o[1],o=o[0],!(a&&a!==n||o&&o.toLowerCase()!==i.toLowerCase()||(s||o)&&s!==r)):!0},finishLoad:function(e,n,i,r){i=n?t.strip(i):i,u.isBuild&&(l[e]=i),r(i)},load:function(e,n,i,r){if(r.isBuild&&!r.inlineText)return i(),void 0;u.isBuild=r.isBuild;var a=t.parseName(e),l=a.moduleName+"."+a.ext,p=n.toUrl(l),f=u.useXhr||t.useXhr;!o||f(p,s,c,d)?t.get(p,function(n){t.finishLoad(e,a.strip,n,i)},function(e){i.error&&i.error(e)}):n([l],function(e){t.finishLoad(a.moduleName+"."+a.ext,a.strip,e,i)})},write:function(e,n,i){if(l.hasOwnProperty(n)){var r=t.jsEscape(l[n]);i.asModule(e+"!"+n,"define(function () { return '"+r+"';});\n")}},writeFile:function(e,n,i,r,a){var o=t.parseName(n),s=o.moduleName+"."+o.ext,c=i.toUrl(o.moduleName+"."+o.ext)+".js";t.load(s,i,function(){var n=function(e){return r(c,e)};n.asModule=function(e,t){return r.asModule(e,c,t)},t.write(e,s,n,a)},a)}},"node"===u.env||!u.env&&"undefined"!=typeof process&&process.versions&&process.versions.node?(n=require.nodeRequire("fs"),t.get=function(e,t){var i=n.readFileSync(e,"utf8");0===i.indexOf("ï»¿")&&(i=i.substring(1)),t(i)}):"xhr"===u.env||!u.env&&t.createXhr()?t.get=function(e,n,i){var r=t.createXhr();r.open("GET",e,!0),u.onXhr&&u.onXhr(r,e),r.onreadystatechange=function(){var t,a;4===r.readyState&&(t=r.status,t>399&&600>t?(a=Error(e+" HTTP status: "+t),a.xhr=r,i(a)):n(r.responseText))},r.send(null)}:("rhino"===u.env||!u.env&&"undefined"!=typeof Packages&&"undefined"!=typeof java)&&(t.get=function(e,t){var n,i,r="utf-8",a=new java.io.File(e),o=java.lang.System.getProperty("line.separator"),s=new java.io.BufferedReader(new java.io.InputStreamReader(new java.io.FileInputStream(a),r)),c="";try{for(n=new java.lang.StringBuffer,i=s.readLine(),i&&i.length()&&65279===i.charAt(0)&&(i=i.substring(1)),n.append(i);null!==(i=s.readLine());)n.append(o),n.append(i);c=""+n+""}finally{s.close()}t(c)}),t}),define("text!template-interaction.mustache",[],function(){return'{{{header}}}\n<div data-role="content">\n    {{{content}}}\n</div>\n{{{footer}}}'}),define("text!template-inputPrompt.mustache",[],function(){return'<form method="get">\n    {{{inputs}}}\n    <button type="submit" data-theme="a">Go</button>\n</form>\n'}),define("text!template-form.mustache",[],function(){return'<div id="FormContainer"></div>\n<div id="FormControls" class="ui-grid-b">\n  <div class="ui-block-a">\n    <a id="save" data-role="button" data-icon="edit" data-iconpos="top">Save</a>\n  </div>\n  <div class="ui-block-b">\n    <a id="cancel" data-role="button" data-icon="delete" data-iconpos="top">Cancel</a>\n  </div>\n  <div class="ui-block-c">\n    <a id="submit" data-role="button" data-icon="check" data-iconpos="top">Submit</a>\n  </div>\n</div>\n<div id="FormQueue" class="ui-grid-solo">\n  <div class="ui-block-a">\n    <a id="queue" data-role="button">Pending Queue</a>\n  </div>\n</div>\n\n<div id="cancelPopup" data-role="popup" data-dismissible="false" data-overlay-theme="a" data-theme="c">\n  <div data-role="header">\n    <h1>Cancel Form</h1>\n  </div>\n  <div data-role="content">\n    <h3>Are you sure you want to cancel this form?</h3>\n    <p>This will delete anything you have entered into this form and cannot be undone.</p>\n    <div class="ui-grid-a">\n      <div class="ui-block-a">\n        <a href="#" data-role="button" data-rel="back">Keep Form</a>\n      </div>\n      <div class="ui-block-b">\n        <a href="#" data-role="button">Delete Form</a>\n      </div>\n    </div>\n  </div>\n</div>\n\n\n<div id="pendingPopup" data-role="popup">\n  <div data-role="header">\n    <h1>Pending Queue</h1>\n  </div>\n  <div id="pendingContent" data-role="content">\n  </div>\n</div>\n'}),define("view-interaction-mobile",["jquery","wrapper-backbone","mustache","text!template-interaction.mustache","text!template-inputPrompt.mustache","text!template-form.mustache","model-application-mobile","underscore","BlinkForms","jquerymobile"],function(e,t,n,i,r,a,o,s,c){var d=t.View.extend({initialize:function(){e("body").append(this.$el)},events:{"click [keyword]":"blinklink","click [interaction]":"blinklink","click [category]":"blinklink","click [masterCategory]":"blinklink","click [back]":"back","click [home]":"blinklink","click [login]":"blinklink","click #FormControls #submit":"formSubmit","click #FormControls #cancel":"formCancel","click #FormControls #save":"formSave","click #queue":"pendingQueue",pageremove:"destroy"},attributes:{"data-role":"page"},blinklink:function(t){t.preventDefault();var n,i,r,a,s="",c=!0;for(n="A"!==t.target.tagName?e(t.target).parents("a"):e(t.target),i="",n.attr("keyword")?i=n.attr("keyword"):n.attr("interaction")?i=n.attr("interaction"):n.attr("category")?i=n.attr("category"):n.attr("masterCategory")?i=n.attr("masterCategory"):""===n.attr("home")?i=o.get("siteName"):""===n.attr("login")&&(i=o.has("loginAccess")&&o.has("loginUseInteractions")&&o.has("loginUseInteractions")&&o.has("loginPromptInteraction")?o.get("loginPromptInteraction"):o.get("siteName")),r=0;n[0].attributes.length>r;r+=1)"_"===n[0].attributes[r].name.substr(0,1)&&(c?(c=!1,s="/?args["+n[0].attributes[r].name.substr(1)+"]="+n[0].attributes[r].value):s+="&args["+n[0].attributes[r].name.substr(1)+"]="+n[0].attributes[r].value);a=e.mobile.path.parseLocation().pathname,e.mobile.path.parseLocation().search&&(a=e.mobile.path.parseLocation().pathname.substr(0,e.mobile.path.parseLocation().pathname.length-1)),"/"===a.slice(-1)&&(a=a.slice(0,a.length-1)),e.mobile.changePage(a+"/"+i+s)},back:function(e){e.preventDefault(),history.back()},render:function(t){var d,l,u=this.model.inherit({}),p=this;return s.has(u,"themeSwatch")&&this.$el.attr("data-theme",u.themeSwatch),this.model.has("inputPrompt")&&!this.model.has("args")?(l=this.model.get("inputPrompt"),d="<form>"===l.substr(0,6)?l:n.render(r,{inputs:l}),this.$el.html(n.render(i,{header:u.header,footer:u.footer,content:d})),this.trigger("render")):this.model.has("type")&&"xslt"===this.model.get("type")?(this.model.once("change:content",function(){"object"==typeof p.model.get("content")&&(p.$el.html(n.render(i,{header:u.header,footer:u.footer,content:""})),p.$el.children("[data-role=content]")[0].appendChild(p.model.get("content")),p.processStars(),p.trigger("render"))}),this.model.performXSLT()):this.model.has("type")&&"form"===this.model.get("type")?(this.$el.html(n.render(i,{header:u.header,footer:u.footer,content:a})),c.getDefinition(this.model.get("blinkFormObjectName"),this.model.get("blinkFormAction")).then(function(t){c.initialize(t),e("#FormContainer").append(c.currentFormObject.$form),e("#FormContainer").trigger("create")}),this.trigger("render")):this.model.id.toLowerCase()===window.BMP.siteVars.answerSpace.toLowerCase()?require(["text!template-category-list.mustache"],function(e){p.$el.html(n.render(i,{header:u.header,footer:u.footer,content:n.render(e,{models:s.map(s.filter(o.interactions.models,function(e){return e.id!==window.BMP.siteVars.answerSpace&&(e.has("tags")&&0===e.get("tags").length&&"hide"!==e.get("display")||s.filter(e.get("tags"),function(e){return e==="nav-"+window.BMP.siteVars.answerSpace.toLowerCase()},this).length>0)},this),function(e){return e.attributes}),path:t.dataUrl})})),p.trigger("render")}):this.model.has("type")?"message"===this.model.get("type")?(this.$el.html(n.render(i,{header:u.header,footer:u.footer,content:u.message})),this.trigger("render")):(this.$el.html(n.render(i,u)),this.model.has("content")&&(this.blinkAnswerMessages(),this.maps(),this.processStars()),this.trigger("render")):require(["text!template-category-list.mustache"],function(e){p.$el.html(n.render(i,{header:u.header,footer:u.footer,content:n.render(e,{models:s.map(s.filter(o.interactions.models,function(e){return"hide"!==e.get("display")&&s.filter(e.get("tags"),function(e){return e==="nav-"+this.model.id.toLowerCase()},this).length>0},p),function(e){return e.attributes}),path:t.dataUrl})})),p.trigger("render")}),this},maps:function(){var e=this.$el.find("[class=googlemap]");0!==e.length&&(this.$el.append('<style type="text/css">.googlemap { width: 100%; height: 360px; }</style>'),this.$el.append('<script src="/_BICv3_/js/gMaps.js"></script>'))},blinkAnswerMessages:function(t){if(t)t=JSON.parse(t),"string"==typeof t.mojotarget&&("string"==typeof t.mojoxml?o.datasuitcases.create({_id:t.mojotarget,data:t.mojoxml}):void 0!==t.mojodelete&&o.datasuitcases.remove(t.mojotarget)),t.startype&&(t.clearstars&&o.stars.clear(t.startype),"array"===e.type(t.staroff)&&s.each(t.staroff,function(e){o.stars.get(e)&&o.stars.get(""+e).destroy()},this),"array"===e.type(t.staron)&&require(["model-star-mobile"],function(){s.each(t.staron,function(e){o.stars.create({_id:""+e,type:t.startype,state:!0})})}));else{var n=this.model.get("content").match(/<!-- blinkAnswerMessage:\{.*\} -->/g);"array"===e.type(n)&&s.each(n,function(e){this.blinkAnswerMessages(e.substring(24,e.length-4))},this)}},formSubmit:function(){var e=this;c.currentFormObject.data().then(function(t){o.pending.create({type:"Form",status:"Pending",name:e.model.get("blinkFormObjectName"),action:e.model.get("blinkFormAction"),answerspaceid:o.get("dbid"),data:t}),o.pending.processQueue()})},formCancel:function(){e("#cancelPopup").popup("open")},formSave:function(){var e=this;c.currentFormObject.data().then(function(t){o.pending.create({type:"Form",status:"Draft",name:e.model.get("blinkFormObjectName"),action:e.model.get("blinkFormAction"),answerspaceid:o.get("dbid"),data:JSON.stringify(t)}),o.pending.processQueue()})},pendingQueue:function(){require(["text!template-pending-mobile.mustache"],function(t){var i=e("#pendingContent");i.html(n.render(t,{pending:s.map(o.pending.where({status:"Pending"}),function(e){return s.clone(e.attributes)}),draft:s.map(o.pending.where({status:"Draft"}),function(e){return s.clone(e.attributes)})})),e("#pendingPopup").popup("open")})},destroy:function(){this.remove()},processStars:function(){var t=this.$el.find(".blink-starrable");t&&require(["view-star-mobile","model-star-mobile"],function(n,i){t.each(function(t,r){var a,s,c=o.stars.get(e(r).data("id"));c||(s=e(r).data(),s._id=""+s.id,delete s.id,s.state=!1,c=new i(s)),a=new n({model:c,el:r})})})}});return d}),define("router-mobile",["wrapper-backbone","model-application-mobile","model-interaction-mobile","view-interaction-mobile","jquery","underscore","jquerymobile"],function(e,t,n,i,r,a){var o=e.Router.extend({initialize:function(){t.router=this,r(document).on("pagebeforeload",function(e,n){e.preventDefault(),r.mobile.loading("show");var a=r.mobile.path.parseUrl(n.dataUrl);t.router.inheritanceChain(a.hrefNoSearch).parseArgs(a.search.substr(1)).prepareView(n).then(function(e){new i({tagName:"div",model:e}).once("render",function(){this.$el.attr("data-url",n.dataUrl),this.$el.attr("data-external-page",!0),this.$el.one("pagecreate",r.mobile._bindPageRemove),n.deferred.resolve(n.absUrl,n.options,this.$el)}).render(n)},function(){n.deferred.reject(n.absUrl,n.options),r.mobile.showPageLoadingMsg(r.mobile.pageLoadErrorMessageTheme,r.mobile.pageLoadErrorMessage,!0),setTimeout(r.mobile.hidePageLoadingMsg,1500)})})},inheritanceChain:function(e){var n,i,r;return n=e.substr(1).split("/"),i="app",r=[],""===n[n.length-1]&&n.pop(),a.each(n,function(e){a.find(r,function(t){return t===e})||(i=t.interactions.get(e).set({parent:i}).id,r.push(e))},this),t.interactions.get(i)}});return new o}),requirejs.config({baseUrl:"/_BICv3_/scripts",paths:{BlinkForms:["/_BICv3_/js/BlinkForms-jQueryMobile.min"],pouchdb:["/_BICv3_/js/pouchdb-nightly"]},shim:{BlinkForms:{exports:"BlinkForms"},pouchdb:{exports:"Pouch"}}}),define("main",["wrapper-backbone","router-mobile","model-interaction-mobile","view-interaction-mobile","jquery","jquerymobile"],function(e,t,n,i,r){function a(){require(["domReady","model-application-mobile"],function(e,t){r.mobile.defaultPageTransition=t.get("defaultTransition"),e(function(){r.mobile.changePage(r.mobile.path.parseLocation().pathname,{changeHash:!1,reloadPage:!0,transition:"fade"}),r(document).on("pageshow",function(){r("#temp").remove()})})})}function o(){r.ajaxPrefilter(function(e,t,n){n.setRequestHeader("X-Blink-Config",JSON.stringify(window.BMP.siteVars))}),require(["model-application-mobile"],function(e){e.once("initialize",function(){navigator.onLine?e.populate().done(function(){a()}):e.set({_id:window.BMP.siteVars.answerSpace}).fetch({success:function(){a()},error:function(){e.populate().done(function(){a()})}})})})}function s(){window.BMP.isBlinkGap===!0?cordova.available===!0?o():window.setTimeout(s(),1e3):o()}s()})})();
//@ sourceMappingURL=main.js.map